// lpu_oi.js - BASEADA NAS MATRIZES DIRETAS (ATUALIZADO)
// CORREÇÃO: Uso de valores exatos por Grupo/Velocidade (sem multiplicadores aproximados).

// --- 1. MATRIZES DE DADOS (PREÇO MENSAL, INSTALAÇÃO) ---

const OI_IP_MATRIX = {
    4: { g1: [355.88, 1500.00], g2: [388.24, 1500.00], g3: [420.59, 1800.00], g4: [640.59, 2100.00], g5: [711.77, 2750.00] },
    5: { g1: [355.88, 1500.00], g2: [388.24, 1500.00], g3: [420.59, 1800.00], g4: [640.59, 2100.00], g5: [711.77, 2750.00] },
    10: { g1: [355.88, 1500.00], g2: [388.24, 1500.00], g3: [420.59, 1800.00], g4: [640.59, 2100.00], g5: [711.77, 2750.00] },
    20: { g1: [430.29, 1500.00], g2: [469.41, 1500.00], g3: [508.53, 1800.00], g4: [774.53, 2100.00], g5: [860.59, 2750.00] },
    30: { g1: [559.34, 1950.00], g2: [610.20, 1950.00], g3: [661.05, 2340.00], g4: [1006.83, 2730.00], g5: [1118.70, 3575.00] },
    40: { g1: [727.22, 2100.00], g2: [793.33, 2100.00], g3: [859.45, 2520.00], g4: [1309.00, 2940.00], g5: [1454.45, 3850.00] },
    50: { g1: [945.42, 2100.00], g2: [1031.38, 2100.00], g3: [1117.32, 2520.00], g4: [1531.59, 2940.00], g5: [1890.85, 3850.00] },
    100: { g1: [1229.05, 2100.00], g2: [1340.79, 2100.00], g3: [1452.52, 2520.00], g4: [1991.07, 2940.00], g5: [2458.11, 3850.00] },
    200: { g1: [1474.93, 3000.00], g2: [1609.03, 3000.00], g3: [1743.11, 3600.00], g4: [2389.40, 4200.00], g5: [2949.88, 5500.00] },
    300: { g1: [1770.07, 3000.00], g2: [1930.98, 3000.00], g3: [2091.90, 3960.00], g4: [2867.51, 4620.00], g5: [3540.13, 6050.00] },
    400: { g1: [2124.16, 3450.00], g2: [2317.26, 3450.00], g3: [2510.37, 4140.00], g4: [3441.13, 4830.00], g5: [4248.31, 6325.00] },
    500: { g1: [2549.05, 3600.00], g2: [2780.79, 3600.00], g3: [3012.52, 4320.00], g4: [4129.47, 5040.00], g5: [5098.11, 6600.00] },
    1000: { g1: [3848.92, 6000.00], g2: [4198.83, 6000.00], g3: [4548.74, 7200.00], g4: [6235.26, 8399.99], g5: [7697.86, 10999.99] }
};

const OI_L2_MATRIX = {
    4: { g1: [407.69, 2700.00], g2: [441.67, 3240.00], g3: [672.69, 3780.00], g4: [747.44, 4950.00] },
    5: { g1: [407.69, 2700.00], g2: [441.67, 3240.00], g3: [672.69, 3780.00], g4: [747.44, 4950.00] },
    10: { g1: [407.69, 2700.00], g2: [441.67, 3240.00], g3: [672.69, 3780.00], g4: [747.44, 4950.00] },
    20: { g1: [530.00, 2700.00], g2: [574.17, 3240.00], g3: [874.50, 3780.00], g4: [971.67, 4950.00] },
    30: { g1: [774.61, 3510.00], g2: [839.17, 4212.00], g3: [1278.11, 4914.00], g4: [1420.13, 6435.00] },
    40: { g1: [978.46, 3780.00], g2: [1060.00, 4536.00], g3: [1614.46, 5292.00], g4: [1793.84, 6930.00] },
    50: { g1: [1223.08, 3780.00], g2: [1325.00, 4536.00], g3: [2018.07, 5292.00], g4: [2242.31, 6930.00] },
    100: { g1: [1630.77, 3780.00], g2: [1766.66, 4536.00], g3: [2690.77, 5292.00], g4: [2989.74, 6930.00] },
    200: { g1: [1834.61, 5100.00], g2: [1987.50, 6120.00], g3: [3027.11, 7140.00], g4: [3363.46, 7700.00] },
    300: { g1: [1956.92, 5100.00], g2: [2120.00, 6732.00], g3: [3228.92, 7854.00], g4: [3587.69, 8470.00] },
    400: { g1: [2364.61, 5865.00], g2: [2561.66, 7038.00], g3: [3901.61, 8211.00], g4: [4335.12, 8855.00] },
    500: { g1: [3139.23, 6120.00], g2: [3400.83, 7344.00], g3: [5179.73, 8568.00], g4: [5755.25, 9240.00] },
    1000: { g1: [4484.61, 8400.00], g2: [4858.33, 10080.00], g3: [7399.61, 11760.00], g4: [8221.79, 13200.00] }
};

const OI_BDL_MATRIX = {
    4: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    5: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    10: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    20: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    30: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    40: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    50: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    100: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    200: { g1: [272.63, 550.00], g2: [300.57, 750.00], g3: [300.57, 750.00], g4: [375.72, 750.00], g5: [432.07, 850.00], g6: [496.88, 850.00] },
    300: { g1: [343.37, 550.00], g2: [378.57, 750.00], g3: [378.57, 750.00], g4: [473.21, 750.00], g5: [544.19, 850.00], g6: [625.82, 850.00] },
    400: { g1: [377.71, 550.00], g2: [416.42, 750.00], g3: [416.42, 750.00], g4: [520.53, 750.00], g5: [598.61, 850.00], g6: [688.40, 850.00] },
    500: { g1: [415.48, 550.00], g2: [458.06, 750.00], g3: [458.06, 750.00], g4: [572.58, 750.00], g5: [658.47, 850.00], g6: [757.24, 850.00] },
    1000: { g1: [540.12, 550.00], g2: [595.48, 750.00], g3: [595.48, 750.00], g4: [744.35, 750.00], g5: [856.01, 850.00], g6: [984.41, 850.00] }
};


// --- 2. REGRAS DE NEGÓCIO (GROUPS E DECAY) ---

// lpu_oi.js - ATUALIZADO
const OI_RULES = {
    // Unificado com Claro/Vivo/Cirion
    taxMonthly: 1.336,
    taxInst: 1.166,

    groups: {
        // Alinhado ao novo padrão lpu_config.js
        "DF": "g1",
        "SP": "g2",
        "MG": "g2",
        "ES": "g2",
        "PR": "g2",
        "SC": "g2",
        "RS": "g2",
        "GO": "g2",
        "MS": "g2",
        "MT": "g2",
        "BA": "g2",
        "SE": "g2",
        "AL": "g2",
        "PE": "g2",
        "PB": "g2",
        "RN": "g2",
        "CE": "g2",
        "PI": "g2",
        "MA": "g2",
        "PA": "g3",
        "TO": "g3",
        "AC": "g3",
        "AP": "g3",
        "AM": "g3",
        "RO": "g3",
        "RJ": "g4",
        "RR": "g4"
    },

    decay: {
        ip: { 12: 1.00, 24: 0.90, 36: 0.85, 48: 0.80, 60: 0.75 },
        l2: { 12: 1.00, 24: 0.90, 36: 0.85, 60: 0.81 },
        bdl: { 12: 1.00, 24: 0.95, 36: 0.90 }
    }
};

(function gerarOi() {
    const allUfs = Object.keys(OI_RULES.groups);
    const speeds = VELOCIDADES_DISPONIVEIS;

    allUfs.forEach(uf => {
        const groupKey = OI_RULES.groups[uf];

        speeds.forEach(v => {
            const processProduct = (prodName, matrix, decayMap) => {
                // Se a matriz não tiver g4 (RJ/RR), usa g3 como fallback seguro
                const data = matrix[v] ? (matrix[v][groupKey] || matrix[v]["g3"]) : null;

                if (data) {
                    const [rawMonthly, rawInst] = data;
                    Object.keys(decayMap).forEach(prazo => {
                        const fator = decayMap[prazo];
                        const mClean = rawMonthly * fator;
                        const iClean = rawInst;

                        addEntry('Oi', prodName, uf, prazo, v,
                            mClean,
                            mClean * OI_RULES.taxMonthly,
                            iClean,
                            iClean * OI_RULES.taxInst
                        );
                    });
                }
            };

            processProduct('IP DEDICADO', OI_IP_MATRIX, OI_RULES.decay.ip);
            processProduct('L2-MPLS', OI_L2_MATRIX, OI_RULES.decay.l2);
            processProduct('BANDA LARGA', OI_BDL_MATRIX, OI_RULES.decay.bdl);
        });
    });
    console.log("Ofertas Oi Atualizadas e Coerentes.");
})();