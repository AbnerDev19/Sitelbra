// lpu_geral.js
// ATUALIZADO EM: 27/01/2026 - Matriz Real (Baseada na Tabela Unificada Claro/Vivo)
// Produtos: IP, L2 e BDL (12, 24, 36, 60 meses)

const GERAL_RULES = {
    // Impostos idênticos à tabela unificada
    taxMonthly: 1.336,
    taxInst: 1.166,

    // Mesma divisão de grupos
    groups: {
        "AL": 1,
        "BA": 1,
        "CE": 1,
        "DF": 1,
        "ES": 1,
        "GO": 1,
        "MA": 1,
        "MT": 1,
        "MS": 1,
        "MG": 1,
        "PB": 1,
        "PR": 1,
        "PE": 1,
        "PI": 1,
        "RN": 1,
        "RS": 1,
        "SC": 1,
        "SP": 1,
        "SE": 1,
        "PA": 2,
        "TO": 2,
        "AC": 3,
        "AP": 3,
        "AM": 3,
        "RO": 3,
        "RJ": 4,
        "RR": 4
    },

    // Decaimento calculado dos prints
    decay: {
        ip: { 12: 1.00, 24: 0.8333, 36: 0.7916, 60: 0.7719 },
        l2: { 12: 1.00, 24: 0.9523, 36: 0.9047, 60: 0.8595 },
        bdl: { 12: 1.00, 24: 0.9524, 36: 0.9048 }
    }
};

// --- MATRIZES BASE 12 MESES (Espelho Claro/Vivo) ---

const LPU_GERAL_L2_MATRIX = {
    4: { g1: [346.50, 1500.00], g2: [375.38, 1800.00], g3: [571.73, 2100.00], g4: [635.25, 2750.00] },
    5: { g1: [346.50, 1500.00], g2: [375.38, 1800.00], g3: [571.73, 2100.00], g4: [635.25, 2750.00] },
    10: { g1: [346.50, 1500.00], g2: [375.38, 1800.00], g3: [571.73, 2100.00], g4: [635.25, 2750.00] },
    20: { g1: [450.45, 1500.00], g2: [487.99, 1800.00], g3: [743.24, 2100.00], g4: [825.83, 2750.00] },
    30: { g1: [658.35, 1950.00], g2: [713.21, 2340.00], g3: [1086.28, 2730.00], g4: [1206.97, 3575.00] },
    40: { g1: [831.60, 2100.00], g2: [900.90, 2520.00], g3: [1372.14, 2940.00], g4: [1524.60, 3850.00] },
    50: { g1: [1039.50, 2100.00], g2: [1126.12, 2520.00], g3: [1715.17, 2940.00], g4: [1905.75, 3850.00] },
    100: { g1: [1386.00, 2100.00], g2: [1501.50, 2520.00], g3: [2286.90, 2940.00], g4: [2541.00, 3850.00] },
    200: { g1: [1559.25, 3000.00], g2: [1689.19, 3600.00], g3: [2572.76, 4200.00], g4: [2858.62, 5500.00] },
    300: { g1: [1663.20, 3300.00], g2: [1801.80, 3960.00], g3: [2744.28, 4620.00], g4: [3049.20, 6050.00] },
    400: { g1: [2009.70, 3450.00], g2: [2177.17, 4140.00], g3: [3316.00, 4830.00], g4: [3684.45, 6325.00] },
    500: { g1: [2668.05, 3600.00], g2: [2890.39, 4320.00], g3: [4402.28, 5040.00], g4: [4891.42, 6600.00] },
    1000: { g1: [3811.50, 6000.00], g2: [4129.12, 7200.00], g3: [6288.97, 8400.00], g4: [6987.74, 11000.00] }
};

const LPU_GERAL_IP_MATRIX = {
    4: { g1: [346.50, 1500.00], g2: [375.38, 1800.00], g3: [571.73, 2100.00], g4: [635.25, 2750.00] },
    5: { g1: [346.50, 1500.00], g2: [375.38, 1800.00], g3: [571.73, 2100.00], g4: [635.25, 2750.00] },
    10: { g1: [346.50, 1500.00], g2: [375.38, 1800.00], g3: [571.73, 2100.00], g4: [635.25, 2750.00] },
    20: { g1: [418.95, 1500.00], g2: [453.86, 1800.00], g3: [691.27, 2100.00], g4: [768.07, 2750.00] },
    30: { g1: [544.60, 1950.00], g2: [589.98, 2340.00], g3: [898.59, 2730.00], g4: [998.43, 3575.00] },
    40: { g1: [708.05, 2100.00], g2: [767.06, 2520.00], g3: [1168.28, 2940.00], g4: [1298.09, 3850.00] },
    50: { g1: [920.50, 2100.00], g2: [997.21, 2520.00], g3: [1518.82, 2940.00], g4: [1687.58, 3850.00] },
    100: { g1: [1196.65, 2100.00], g2: [1296.37, 2520.00], g3: [1974.47, 2940.00], g4: [2193.86, 3850.00] },
    200: { g1: [1436.05, 3000.00], g2: [1555.72, 3600.00], g3: [2369.48, 4200.00], g4: [2632.76, 5500.00] },
    300: { g1: [1723.40, 3300.00], g2: [1867.02, 3960.00], g3: [2843.61, 4620.00], g4: [3159.57, 6050.00] },
    400: { g1: [2068.15, 3450.00], g2: [2240.50, 4140.00], g3: [3412.45, 4830.00], g4: [3791.61, 6325.00] },
    500: { g1: [2481.85, 3600.00], g2: [2688.67, 4320.00], g3: [4095.05, 5040.00], g4: [4550.06, 6600.00] },
    1000: { g1: [3747.45, 6000.00], g2: [4059.74, 7200.00], g3: [6183.29, 8400.00], g4: [6870.33, 11000.00] }
};

const LPU_GERAL_BDL_MATRIX = {
    4: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    5: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    10: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    20: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    30: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    40: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    50: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    100: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    200: { g1: [208.95, 550.00], g2: [226.36, 750.00], g3: [292.53, 750.00], g4: [358.70, 850.00] },
    300: { g1: [271.64, 550.00], g2: [294.27, 750.00], g3: [380.29, 750.00], g4: [466.31, 850.00] },
    400: { g1: [292.53, 550.00], g2: [316.90, 750.00], g3: [409.54, 750.00], g4: [502.18, 850.00] },
    500: { g1: [313.42, 550.00], g2: [339.54, 750.00], g3: [438.79, 750.00], g4: [538.05, 850.00] },
    1000: { g1: [555.11, 550.00], g2: [601.36, 750.00], g3: [777.16, 750.00], g4: [952.95, 850.00] }
};

(function gerarGeral() {
    const allUfs = Object.keys(UF_GROUPS);

    allUfs.forEach(uf => {
        let gId = GERAL_RULES.groups[uf] || 1;
        const gKey = `g${gId}`;

        VELOCIDADES_DISPONIVEIS.forEach(v => {

            const processMatrix = (prodName, matrix, decayKey) => {
                if (matrix[v] && matrix[v][gKey]) {
                    const [baseMensal, baseInst] = matrix[v][gKey];
                    const prazos = (decayKey === 'bdl') ? [12, 24, 36] : [12, 24, 36, 60];

                    prazos.forEach(d => {
                        const fator = GERAL_RULES.decay[decayKey][d] || 1.0;
                        const mClean = baseMensal * fator;
                        const mFull = mClean * GERAL_RULES.taxMonthly;
                        const iClean = baseInst;
                        const iFull = iClean * GERAL_RULES.taxInst;

                        addEntry('Geral', prodName, uf, d, v, mClean, mFull, iClean, iFull);
                    });
                }
            };

            processMatrix('IP DEDICADO', GERAL_IP_MATRIX, 'ip');
            processMatrix('L2-MPLS', GERAL_L2_MATRIX, 'l2');
            processMatrix('BANDA LARGA', GERAL_BDL_MATRIX, 'bdl');
        });
    });
    console.log("Ofertas Geral Carregadas.");
})();