// lpu_claro.js
// ATUALIZADO EM: 27/01/2026 - Matriz Real (Unificada Claro/Vivo)
// Produtos: IP, L2 e BDL (12, 24, 36, 60 meses)

const CLARO_RULES = {
    taxMonthly: 1.336, // ~33.6%
    taxInst: 1.166, // ~16.6%

    groups: {
        // G1: Geral
        "AL": 1,
        "BA": 1,
        "CE": 1,
        "DF": 1,
        "ES": 1,
        "GO": 1,
        "MA": 1,
        "MT": 1,
        "MS": 1,
        "MG": 1,
        "PB": 1,
        "PR": 1,
        "PE": 1,
        "PI": 1,
        "RN": 1,
        "RS": 1,
        "SC": 1,
        "SP": 1,
        "SE": 1,
        // G2: PA, TO
        "PA": 2,
        "TO": 2,
        // G3: Norte
        "AC": 3,
        "AP": 3,
        "AM": 3,
        "RO": 3,
        // G4: RJ, RR (Crítico)
        "RJ": 4,
        "RR": 4
    },

    // Decaimento calculado dos prints (Ex: IP 24m 248.75 / 298.50 = 0.833)
    decay: {
        ip: { 12: 1.00, 24: 0.9002, 36: 0.9444, 48: 0.9444, 60: 0.9444 },
        l2: { 12: 1.00, 24: 0.9523, 36: 0.9047, 60: 0.8595 },
        bdl: { 12: 1.00, 24: 0.9524, 36: 0.9048 }
    }
};

// --- MATRIZES BASE 12 MESES (CLEAN) ---
// Formato: Velocidade: { g1: [Mensal, Inst], ... }

const CLARO_IP_MATRIX = {
    4: { g1: [388.24, 1500.00], g2: [420.59, 1800.00], g3: [640.59, 2100.00], g4: [711.77, 2750.00] },
    5: { g1: [388.24, 1500.00], g2: [420.59, 1800.00], g3: [640.59, 2100.00], g4: [711.77, 2750.00] },
    10: { g1: [388.24, 1500.00], g2: [420.59, 1800.00], g3: [640.59, 2100.00], g4: [711.77, 2750.00] },
    20: { g1: [469.41, 1500.00], g2: [508.53, 1800.00], g3: [774.53, 2100.00], g4: [860.59, 2750.00] },
    30: { g1: [610.20, 1950.00], g2: [661.05, 2340.00], g3: [1006.83, 2730.00], g4: [1118.70, 3575.00] },
    40: { g1: [793.33, 2100.00], g2: [859.45, 2520.00], g3: [1309.00, 2940.00], g4: [1454.45, 3850.00] },
    50: { g1: [1031.38, 2100.00], g2: [1117.32, 2520.00], g3: [1531.59, 2940.00], g4: [1890.85, 3850.00] },
    100: { g1: [1340.79, 2100.00], g2: [1452.52, 2520.00], g3: [1991.07, 2940.00], g4: [2458.11, 3850.00] },
    200: { g1: [1609.03, 3000.00], g2: [1743.11, 3600.00], g3: [2389.40, 4200.00], g4: [2949.88, 5500.00] },
    300: { g1: [1930.98, 3000.00], g2: [2091.90, 3960.00], g3: [2867.51, 4620.00], g4: [3540.13, 6050.00] },
    400: { g1: [2317.26, 3450.00], g2: [2510.37, 4140.00], g3: [3441.13, 4830.00], g4: [4248.31, 6325.00] },
    500: { g1: [2780.79, 3600.00], g2: [3012.52, 4320.00], g3: [4129.47, 5040.00], g4: [5098.11, 6600.00] },
    1000: { g1: [4198.83, 6000.00], g2: [4548.74, 7200.00], g3: [6235.26, 8399.99], g4: [7697.86, 10999.99] }
};

const CLARO_L2_MATRIX = {
    4: { g1: [388.28, 1500.00], g2: [420.63, 1800.00], g3: [640.66, 2100.00], g4: [711.84, 2750.00] },
    5: { g1: [388.28, 1500.00], g2: [420.63, 1800.00], g3: [640.66, 2100.00], g4: [711.84, 2750.00] },
    10: { g1: [388.28, 1500.00], g2: [420.63, 1800.00], g3: [640.66, 2100.00], g4: [711.84, 2750.00] },
    20: { g1: [504.76, 1500.00], g2: [546.82, 1800.00], g3: [832.86, 2100.00], g4: [925.40, 2750.00] },
    30: { g1: [737.73, 1950.00], g2: [799.21, 2340.00], g3: [1217.25, 2730.00], g4: [1352.50, 3575.00] },
    40: { g1: [931.87, 2100.00], g2: [1009.52, 2520.00], g3: [1537.58, 2940.00], g4: [1708.42, 3850.00] },
    50: { g1: [1164.83, 2100.00], g2: [1261.90, 2520.00], g3: [1921.98, 2940.00], g4: [2135.53, 3850.00] },
    100: { g1: [1553.11, 2100.00], g2: [1682.54, 2520.00], g3: [2562.63, 2940.00], g4: [2847.37, 3850.00] },
    200: { g1: [1747.25, 3000.00], g2: [1892.86, 3600.00], g3: [2882.96, 4200.00], g4: [3203.29, 5500.00] },
    300: { g1: [1863.73, 3000.00], g2: [2019.05, 3600.00], g3: [3075.16, 4200.00], g4: [3416.85, 5500.00] },
    400: { g1: [2252.01, 3450.00], g2: [2439.68, 4140.00], g3: [3715.82, 4830.00], g4: [4128.69, 6325.00] },
    500: { g1: [2989.74, 3600.00], g2: [3238.89, 4320.00], g3: [4933.07, 5040.00], g4: [5481.19, 6600.00] },
    1000: { g1: [4271.06, 6000.00], g2: [4626.98, 7200.00], g3: [7047.25, 8400.00], g4: [7830.27, 11000.00] }
};

const CLARO_BDL_MATRIX = {
    4: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    5: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    10: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    20: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    50: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    100: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    200: { g1: [286.26, 550.00], g2: [300.57, 750.00], g3: [375.72, 750.00], g4: [496.88, 850.00] },
    300: { g1: [360.54, 550.00], g2: [378.57, 750.00], g3: [473.21, 750.00], g4: [625.82, 850.00] },
    400: { g1: [396.59, 550.00], g2: [416.42, 750.00], g3: [520.53, 750.00], g4: [688.40, 850.00] },
    500: { g1: [436.25, 550.00], g2: [458.06, 750.00], g3: [572.58, 750.00], g4: [757.24, 850.00] },
    1000: { g1: [567.13, 550.00], g2: [595.48, 750.00], g3: [744.35, 750.00], g4: [984.41, 850.00] }
};

(function gerarClaro() {
    const allUfs = Object.keys(UF_GROUPS);

    allUfs.forEach(uf => {
        let gId = CLARO_RULES.groups[uf] || 1;
        const gKey = `g${gId}`;

        VELOCIDADES_DISPONIVEIS.forEach(v => {

            const processMatrix = (prodName, matrix, decayKey) => {
                if (matrix[v] && matrix[v][gKey]) {
                    const [baseMensal, baseInst] = matrix[v][gKey];
                    // BDL não tem 60 meses
                    const prazos = (decayKey === 'bdl') ? [12, 24, 36] : [12, 24, 36, 60];

                    prazos.forEach(d => {
                        const fator = CLARO_RULES.decay[decayKey][d] || 1.0;
                        const mClean = baseMensal * fator;
                        const mFull = mClean * CLARO_RULES.taxMonthly;
                        const iClean = baseInst;
                        const iFull = iClean * CLARO_RULES.taxInst;

                        addEntry('Claro', prodName, uf, d, v, mClean, mFull, iClean, iFull);
                    });
                }
            };

            processMatrix('IP DEDICADO', CLARO_IP_MATRIX, 'ip');
            processMatrix('L2-MPLS', CLARO_L2_MATRIX, 'l2');
            processMatrix('BANDA LARGA', CLARO_BDL_MATRIX, 'bdl');
        });
    });
    console.log("Ofertas Claro Carregadas.");
})();